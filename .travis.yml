language: php

sudo: true

php:
  - 7.2
  - 7.3
  - hhvm

env:
  global:
    - DRIVER=pdo
    - SPHINX_PORT=9306
  matrix:
    - USE_LARAVEL_VERSION=6.0
    - USE_LARAVEL_VERSION=7.0

matrix:
  fast_finish: true
  allow_failures:
    - php: hhvm

before_install:
  - mkdir -p /var/lib/manticore /var/log/manticore /var/run/manticore
  - mkdir $HOME/manticore
  - pushd $HOME/manticore
  - wget -O manticore.deb --quiet https://github.com/manticoresoftware/manticoresearch/releases/download/3.4.0/manticore_3.4.0-200326-0686d9f-release.xenial_amd64-bin.deb
  - dpkg -x manticore.deb .
  - popd

install:
  - composer require "illuminate/bus:^${USE_LARAVEL_VERSION}"
  - composer install --prefer-dist
  - $HOME/manticore/usr/bin/searchd -c tests/fixtures/sphinx.conf

script:
  - ./vendor/bin/phpunit --coverage-text

notifications:
  email: false
